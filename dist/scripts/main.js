"use strict";function Map(){var e=this;e.map=new google.maps.Map(document.getElementById("map"),{center:{lat:0,lng:0},zoom:12}),e.addMarker=function(n){var o="http://maps.google.com/mapfiles/ms/icons/red.png",t=new google.maps.Marker({position:n.coordinates,map:e.map,title:n.name,icon:o});return t.animationTimeout=null,t.drop=function(){this.setAnimation(google.maps.Animation.DROP)},t.bounce=function(e){this.setAnimation(google.maps.Animation.BOUNCE),this.animationTimeout=setTimeout(function(n){n.setAnimation(null),e()},1400,this)},t.resetAnimation=function(){this.setAnimation(null)},t.setActive=function(){this.setIcon(null)},t.resetActive=function(){this.setIcon(o)},t},e.addInfoWindow=function(n){var o=new google.maps.InfoWindow({content:"Loading information..."});return o.setActive=function(){this.open(e.map,n.marker)},o.updateContent=function(e){this.setContent(e)},o},e.panTo=function(n){e.map.panTo(n.coordinates)}}function LocViewModel(e,n){var o=this;o.name=e.name,o.coordinates=e.coordinates,o.foursquareID=e.foursquareID,o.list=n,o.foursquareInfo=ko.observable(),o.foursquareInfoString=ko.computed(function(){if(void 0===this.foursquareInfo())return"Sorry, the information about this location cannot be retrieved.";var e=o.foursquareInfo(),n="<h3>"+e.name+"<br>";return n+="<small>",e.categories.forEach(function(e){n+='<span class="label label-info">'+e.name+"</span> "}),n+="</small>",n+="</h3>",n+="<address>"+e.address+"</address>",n+='<div class="well">',n+='<span class="rating label label-primary">'+e.rating+" / ",n+='<span class="total">10</span>',n+="</span> ",n+=" Based on "+e.ratingSignals+" votes",n+="</div>",n+='<img class="img-responsive" src="'+e.image+'" alt="'+e.name+'">',n+="<br>",n+="<blockquote>",n+="<p>"+e.comment.text+"</p>",n+="<footer>"+e.comment.author+"</footer>",n+="</blockquote>",n+='<p class="text-muted">Information provided by <a target="_blank" href="https://foursquare.com/v/'+this.foursquareID+'">Foursquare.com</a></p>'},o),o.isActive=ko.computed(function(){return this===this.list.currentLocation()},o),o.isActive.subscribe(function(e){e?(map.panTo(o),o.marker.setActive(),o.marker.bounce(function(){o.infoWindow.setActive()})):(o.marker.resetAnimation(),o.marker.resetActive(),clearTimeout(o.marker.animationTimeout),o.infoWindow.close())}),o.isOnList=ko.computed(function(){return o.list.filteredLocations().indexOf(o)>-1}),o.isOnList.subscribe(function(e){o.marker.setVisible(e),e||o.resetActive()}),o.marker=map.addMarker(o),o.marker.addListener("click",function(){o.setActive()}),o.infoWindow=map.addInfoWindow(o),o.setActive=function(){o.list.setCurrentLocation(o)},o.resetActive=function(){o.list.setCurrentLocation(void 0)},o.updateFoursquareInfo=function(){var e="https://api.foursquare.com/v2/venues/",n="?client_id=MSKSKL5MYNAFMGDCKJOLARZZFV2W4O0A50WJ0HMWFNHQ1YKO&client_secret=4LVCHEYQPLJTEAZ1GTMB3M3UUTIBYUVANJKBQ5IM334OZEV0&v=20130815",t=e+o.foursquareID+n;return $.getJSON(t,function(e){var n={name:e.response.venue.name?e.response.venue.name:"Unnamed",categories:e.response.venue.categories?e.response.venue.categories:["No categories"],address:e.response.venue.location.address?e.response.venue.location.address:"No address information",rating:e.response.venue.rating?e.response.venue.rating:"?",ratingSignals:e.response.venue.ratingSignals?e.response.venue.ratingSignals:"unknown",image:e.response.venue.bestPhoto?e.response.venue.bestPhoto.prefix+"500x500"+e.response.venue.bestPhoto.suffix:null,comment:e.response.venue.tips.groups?{text:e.response.venue.tips.groups[0].items[0].text,author:e.response.venue.tips.groups[0].items[0].user.firstName?e.response.venue.tips.groups[0].items[0].user.firstName:e.response.venue.tips.groups[0].items[0].user.lastName}:{text:"No comments yet.",author:null}};o.foursquareInfo(n)}).always(function(){o.infoWindow.updateContent(o.foursquareInfoString())})},o.updateFoursquareInfo()}function ListViewModel(e){var n=this;n.locations=ko.observableArray(),n.currentLocation=ko.observable(),n.filterKeyword=ko.observable(""),n.filteredLocations=ko.computed(function(){return n.locations().filter(function(e){return e.name.toLowerCase().indexOf(n.filterKeyword().toLowerCase())>-1})},n),n.filteredLocations.subscribe(function(e){e.length>0&&map.panTo(e[0])}),n.sortLocations=function(){n.locations.sort(function(e,n){return e.name>n.name?1:e.name<n.name?-1:0})},n.setCurrentLocation=function(e){n.currentLocation(e)},e.forEach(function(e){n.locations.push(new LocViewModel(e,n))}),n.sortLocations(),map.panTo(n.locations()[0])}!function(){$("#navbar-toggle").click(function(e){e.preventDefault(),$("#wrapper").toggleClass("toggled")}),$("#filter-form").submit(function(e){e.preventDefault()})}();var map;!function(){function e(){map=new Map;var e=new ListViewModel(n);ko.applyBindings(e)}var n;$.when($.getJSON("scripts/models/locations.json",function(e){n=e.locations}),$.getScript("https://maps.googleapis.com/maps/api/js?key=AIzaSyCOvT4WRm8Y1FRgoZZaKo-7M71f1AbNEvI")).then(function(){e()})}();